{"version":3,"file":"smokeTest/userTests.js","mappings":"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","sources":["webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///external commonjs \"k6\"","webpack:///external commonjs \"k6/http\"","webpack:///./support/config/urls.ts","webpack:///./support/config/constants.ts","webpack:///./support/api/identity.ts","webpack:///./smokeTest/userTests.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"k6\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"k6/http\");","const baseUrl = 'http://localhost:8280';\nconst identityUrl = 'http://localhost:8180';\n\nconst identityRealmPath = '/auth/realms/';\nconst identityAuthPath = '/protocol/openid-connect/token';\n\n// Service Names\nconst accessControlServiceName = 'access-control';\nconst arrangementManagerServiceName = 'arrangement-manager';\n\n// Service API Paths\nconst accessControlPath = '/api/' + accessControlServiceName + '/client-api';\nconst arrangementManagerPath = '/api/' + arrangementManagerServiceName + '/client-api';\n\n// Identity\nexport function getIdentityAuthUrl(realm) {\n    return `${identityUrl}${identityRealmPath}${realm}${identityAuthPath}`;\n}\n\n// Access Control\nexport function getUserContextServiceAgreementsUrl() {\n    return `${baseUrl}${accessControlPath}/v3/accessgroups/user-context/service-agreements`;\n}\n\nexport function getUserContextUrl() {\n    return `${baseUrl}${accessControlPath}/v2/accessgroups/usercontext`;\n}\n\n// Arrangement Manager\nexport function getAggregationsPath() {\n    return `${baseUrl}${arrangementManagerPath}/v2/balances/aggregations`\n}\n\nexport function getProductKindsPath() {\n    return `${baseUrl}${arrangementManagerPath}/v2/product-kinds`\n}\n\nexport function getidentityUsersPath(realm) {\n    return `${identityUrl}/auth/admin/realms/${realm}/users`;\n} \n","\n// Client Ids\nconst adminCliClientId = 'admin-cli';\nconst bbToolingClient = 'bb-tooling-client';\n\nconst userContext =\n        'eyJraWQiOiJaNXB5dkxcL3FMYUFyR3ZiTkY3Qm11UGVQU1Q4R0I5UHBPR0RvRnBlbmIxOD0iLCJjdHkiOiJKV1QiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwiYWxnIjoiZGlyIn0..tMfNToj_V8l223g2qq-vAQ.m_sJ7rkBrFBn9n7FDYpS_AKgeclXISyq0uPjE1-2uIjezFW6KpXahPZzyZnZMsWdCqIC_E9J_Rnw63aAa_l05OLKoh5t8h-Ksa35iJ9tn2NG_Mjl8XHwXNPpYxAe0Rxyp7tHA64E2fICGyW2NEUsa9u_DwLarRumStiZljboI12X0xv0zqN7KVBjSBRS0JrAdJ2pYxVEB-KlXdpWuNIoWwPccY4UVhvr32PPzw8AxpDdys1LDf6fxbLy6S3fy0L4LNkvKIq5gzsWD8kvnducMLIK87u9dysl-MeFrznaiecKEQVgqLFsmwRWShujcXHy.AQhfRyuBuACzuMumtlgEMw';\n\nexport function getUserContext() {\n    return userContext;\n}\n","import http from 'k6/http';\nimport { check } from 'k6';\nimport { getIdentityAuthUrl, getidentityUsersPath } from '../config/urls';\nimport { getUserContext } from '../config/constants';\n\nexport function getAccessToken(realm, clientId) {\n  let url = getIdentityAuthUrl(realm);\n\n  let requestBody = { username: 'admin', password: 'admin', grant_type: 'password', client_id: clientId };\n  let response = http.post(url, requestBody, { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } });\n  let access_token = response.json(\"access_token\");\n\n  check(response, {\n    'auth status is 200': () => response.status === 200\n  });\n\n  check(access_token, {\n    'access_token is not empty': () => access_token !== undefined\n  })\n  \n  return access_token;\n}\n\nexport function createUser(access_token, userName) {\n  \n  let url = getidentityUsersPath('backbase');\n  let headers = { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + access_token };\n  let userContext = getUserContext();\n  let cookies = { USER_CONTEXT: userContext };\n\n  let requestBody = { \n        'username': `${userName}`,\n        'enabled': 'true',\n        'firstName': 'BE',\n        'lastName': 'Dev',\n        'credentials': [\n            {\n                'type': 'password',\n                'value': 'password'\n            }\n        ]  \n  };\n  \n  let response = http.post(url, JSON.stringify(requestBody), { headers: headers, cookies: cookies });\n\n  check(response, {\n    'createUser response status code is 201': () => response.status === 201\n  });\n}\n\nexport function getUsers(access_token) {\n  \n  let url = getidentityUsersPath('backbase');\n  let userContext = getUserContext();\n\n  let headers = { 'Accept': '*/*', 'Content-Type': 'application/x-www-form-urlencoded', 'Authorization': 'Bearer ' + access_token };\n  let cookies = { USER_CONTEXT: userContext };\n\n  let response = http.get(url, { headers: headers, cookies: cookies });\n\n  check(response, {\n    'getUsers response status code is 200': () => response.status === 200\n  });\n\n  return response;\n}\n\nexport function deleteUser(access_token, userName) {\n  \n  let userToDelete = getUserByUsername(access_token, userName);\n  let url = `${getidentityUsersPath('backbase')}/${userToDelete.id}`;\n  let userContext = getUserContext();\n\n  let headers = { 'Accept': '*/*', 'Content-Type': 'application/x-www-form-urlencoded', 'Authorization': 'Bearer ' + access_token };\n  let cookies = { USER_CONTEXT: userContext };\n\n  let response = http.del(url, null, { headers: headers, cookies: cookies });\n\n  check(response, {\n    'deleteUser response status code is 204': () => response.status === 204\n  });\n}\n\nfunction getUserByUsername(access_token, userName) {\n  let response = getUsers(access_token);\n\n  let body = response?.body.toString();\n  \n  if (body !== undefined && body !== null) {\n    \n    let users = JSON.parse(body);\n    //ToDo get user by username, rather than getting last used by default return order in response\n    //let user = users.filter(u => u.username == userName);\n    let user = users[users.length - 1];\n\n    check(user, {\n      'User Found': () => user !== undefined && user !== null\n    });\n\n    return user\n\n  } else {\n    check(null, {\n        'Error extracting Users': () => false\n    });\n  }\n\n  return null;\n}\n","import { sleep } from 'k6';\nimport { createUser, deleteUser, getAccessToken, getUsers } from '../support/api/identity';\n\nexport let options = {\n    stages: [\n      { duration: '1s', target: 1 },\n    // ToDo: Requires getting user id by username to run multiple VUs\n    //  { duration: '10s', target: 10 },\n    //  { duration: '10s', target: 100 },\n    //  { duration: '10s', target: 10 },\n    ],\n  };\n  \n  export default () => {\n    const access_token = getAccessToken('master', 'admin-cli');\n    const currentDate = new Date();\n    const timestamp = currentDate.getTime();\n\n    const userName = 'ZZ_k6User_' + timestamp + Math.random();\n\n    createUser(access_token, userName);\n    getUsers(access_token);\n    deleteUser(access_token, userName);\n    \n    sleep(1);\n  };"],"names":["baseUrl","identityUrl","identityRealmPath","identityAuthPath","accessControlServiceName","arrangementManagerServiceName","accessControlPath","arrangementManagerPath","getIdentityAuthUrl","realm","getUserContextServiceAgreementsUrl","getUserContextUrl","getAggregationsPath","getProductKindsPath","getidentityUsersPath","adminCliClientId","bbToolingClient","userContext","getUserContext","http","check","getAccessToken","clientId","url","requestBody","username","password","grant_type","client_id","response","post","headers","access_token","json","status","undefined","createUser","userName","cookies","USER_CONTEXT","JSON","stringify","getUsers","get","deleteUser","userToDelete","getUserByUsername","id","del","body","toString","users","parse","user","length","sleep","options","stages","duration","target","currentDate","Date","timestamp","getTime","Math","random"],"sourceRoot":""}