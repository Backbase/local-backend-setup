{"version":3,"file":"smokeTest/userTests.js","mappings":"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","sources":["webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///external commonjs \"k6\"","webpack:///external commonjs \"k6/http\"","webpack:///./support/config/urls.ts","webpack:///./support/config/constants.ts","webpack:///./support/api/identity.ts","webpack:///./smokeTest/userTests.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"k6\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"k6/http\");","const baseUrl = 'http://localhost:8280';\nconst identityUrl = 'http://localhost:8180';\n\nconst identityRealmPath = '/auth/realms/';\nconst identityAuthPath = '/protocol/openid-connect/token';\n\n// Service Names\nconst accessControlServiceName = 'access-control';\nconst arrangementManagerServiceName = 'arrangement-manager';\n\n// Service API Paths\nconst accessControlPath = '/api/' + accessControlServiceName + '/client-api';\nconst arrangementManagerPath = '/api/' + arrangementManagerServiceName + '/client-api';\n\n// Identity\nexport function getIdentityAuthUrl(realm) {\n    return `${identityUrl}${identityRealmPath}${realm}${identityAuthPath}`;\n}\n\n// Access Control\nexport function getUserContextServiceAgreementsUrl() {\n    return `${baseUrl}${accessControlPath}/v3/accessgroups/user-context/service-agreements`;\n}\n\nexport function getUserContextUrl() {\n    return `${baseUrl}${accessControlPath}/v2/accessgroups/usercontext`;\n}\n\n// Arrangement Manager\nexport function getAggregationsPath() {\n    return `${baseUrl}${arrangementManagerPath}/v2/balances/aggregations`\n}\n\nexport function getProductKindsPath() {\n    return `${baseUrl}${arrangementManagerPath}/v2/product-kinds`\n}\n\nexport function getidentityUsersPath(realm) {\n    return `${identityUrl}/auth/admin/realms/${realm}/users`;\n} \n","\n// Realm Names\nconst backbaseRealmName = 'backbase';\nconst masterRealmName = 'master';\n\n// Client Ids\nconst adminCliClientId = 'admin-cli';\nconst bbToolingClient = 'bb-tooling-client';\n\nconst userContext =\n        'eyJraWQiOiJaNXB5dkxcL3FMYUFyR3ZiTkY3Qm11UGVQU1Q4R0I5UHBPR0RvRnBlbmIxOD0iLCJjdHkiOiJKV1QiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwiYWxnIjoiZGlyIn0..tMfNToj_V8l223g2qq-vAQ.m_sJ7rkBrFBn9n7FDYpS_AKgeclXISyq0uPjE1-2uIjezFW6KpXahPZzyZnZMsWdCqIC_E9J_Rnw63aAa_l05OLKoh5t8h-Ksa35iJ9tn2NG_Mjl8XHwXNPpYxAe0Rxyp7tHA64E2fICGyW2NEUsa9u_DwLarRumStiZljboI12X0xv0zqN7KVBjSBRS0JrAdJ2pYxVEB-KlXdpWuNIoWwPccY4UVhvr32PPzw8AxpDdys1LDf6fxbLy6S3fy0L4LNkvKIq5gzsWD8kvnducMLIK87u9dysl-MeFrznaiecKEQVgqLFsmwRWShujcXHy.AQhfRyuBuACzuMumtlgEMw';\n\nconst userNamePrefix = 'zz_k6user_';\n\nexport function getBackbaseRealmName() {\n    return backbaseRealmName;\n}\n\nexport function getMasterRealmName() {\n    return masterRealmName;\n}\n\nexport function getAdminCliClientId() {\n    return adminCliClientId;\n}\n\nexport function getBbToolingClient() {\n    return bbToolingClient;\n}\n\nexport function getUserContext() {\n    return userContext;\n}\n\nexport function getUserNamePrefix() {\n    return userNamePrefix;\n}\n","import http from 'k6/http';\nimport { check } from 'k6';\nimport { getIdentityAuthUrl, getidentityUsersPath } from '../config/urls';\nimport { getBackbaseRealmName, getUserContext } from '../config/constants';\n\nexport function getAccessToken(realm, clientId) {\n  let url = getIdentityAuthUrl(realm);\n\n  let requestBody = { username: 'admin', password: 'admin', grant_type: 'password', client_id: clientId };\n  let response = http.post(url, requestBody, { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } });\n  let access_token = response.json(\"access_token\");\n\n  check(response, {\n    'auth status is 200': () => response.status === 200\n  });\n\n  check(access_token, {\n    'access_token is not empty': () => access_token !== undefined\n  })\n  \n  return access_token;\n}\n\nexport function createUser(access_token, userName) {\n  \n  let url = getidentityUsersPath(getBackbaseRealmName());\n  let headers = { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + access_token };\n  let userContext = getUserContext();\n  let cookies = { USER_CONTEXT: userContext };\n\n  let requestBody = { \n        'username': `${userName}`,\n        'enabled': 'true',\n        'firstName': 'BE',\n        'lastName': 'Dev',\n        'credentials': [\n            {\n                'type': 'password',\n                'value': 'password'\n            }\n        ]  \n  };\n  \n  let response = http.post(url, JSON.stringify(requestBody), { headers: headers, cookies: cookies });\n\n  check(response, {\n    'createUser response status code is 201': () => response.status === 201\n  });\n}\n\nexport function getUsers(access_token, userName) {\n  \n  let url = getidentityUsersPath(getBackbaseRealmName());\n  let userContext = getUserContext();\n\n  let headers = { 'Accept': '*/*', 'Content-Type': 'application/x-www-form-urlencoded', 'Authorization': 'Bearer ' + access_token };\n  let cookies = { USER_CONTEXT: userContext };\n\n  let response = http.get(url, { headers: headers, cookies: cookies });\n\n  check(response, {\n    'getUsers response status code is 200': () => response.status === 200\n  });\n\n  let body = response?.body?.toString();\n\n  if (body !== undefined && body !== null) {\n    check(response, {\n      'getUsers response contains userName': () => String(body).includes(userName)\n    });\n  } else {\n    check(null, {\n      'Error extracting Users': () => false\n    });\n  }\n\n  return response;\n}\n\n\nexport function getUserIdByUsername(getUsersResponse, userName) {\n  \n  let body = getUsersResponse.body.toString();\n  \n  if (body !== undefined && body !== null) {\n    \n    let users = JSON.parse(body);\n    let userFilter = users.filter(u => u.username == userName);\n    let user = JSON.parse(JSON.stringify(userFilter))[0];\n\n    check(user, {\n      'User Found': () => user !== undefined && user !== null && user.username == userName\n    });\n\n    return user.id;\n\n  } else {\n    check(null, {\n        'Error extracting Users': () => false\n    });\n  }\n\n  return null;\n}\n\nexport function deleteUser(access_token, userId) {\n  \n  let url = `${getidentityUsersPath('backbase')}/${userId}`;\n  let userContext = getUserContext();\n\n  let headers = { 'Accept': '*/*', 'Content-Type': 'application/x-www-form-urlencoded', 'Authorization': 'Bearer ' + access_token };\n  let cookies = { USER_CONTEXT: userContext };\n\n  let response = http.del(url, null, { headers: headers, cookies: cookies });\n\n  check(response, {\n    'deleteUser response status code is 204': () => response.status === 204\n  });\n}\n\n","import { sleep } from 'k6';\nimport { createUser, deleteUser, getAccessToken, getUserIdByUsername, getUsers } from '../support/api/identity';\nimport { getAdminCliClientId, getMasterRealmName, getUserNamePrefix } from '../support/config/constants';\n\nexport let options = {\n    stages: [\n      { duration: '10s', target: 10 },\n      { duration: '10s', target: 100 },\n      { duration: '10s', target: 10 },\n    ],\n  };\n  \n  export default () => {\n    let access_token = getAccessToken(getMasterRealmName(), getAdminCliClientId());\n    let currentDate = new Date();\n    let timestamp = currentDate.getTime();\n\n    let userName = getUserNamePrefix() + timestamp + Math.random();\n    \n    createUser(access_token, userName);\n\n    let users = getUsers(access_token, userName);\n    let userId = getUserIdByUsername(users, userName);\n    \n    deleteUser(access_token, userId);\n    \n    sleep(1);\n  };\n"],"names":["baseUrl","identityUrl","identityRealmPath","identityAuthPath","accessControlServiceName","arrangementManagerServiceName","accessControlPath","arrangementManagerPath","getIdentityAuthUrl","realm","getUserContextServiceAgreementsUrl","getUserContextUrl","getAggregationsPath","getProductKindsPath","getidentityUsersPath","backbaseRealmName","masterRealmName","adminCliClientId","bbToolingClient","userContext","userNamePrefix","getBackbaseRealmName","getMasterRealmName","getAdminCliClientId","getBbToolingClient","getUserContext","getUserNamePrefix","http","check","getAccessToken","clientId","url","requestBody","username","password","grant_type","client_id","response","post","headers","access_token","json","status","undefined","createUser","userName","cookies","USER_CONTEXT","JSON","stringify","getUsers","get","body","toString","String","includes","getUserIdByUsername","getUsersResponse","users","parse","userFilter","filter","u","user","id","deleteUser","userId","del","sleep","options","stages","duration","target","currentDate","Date","timestamp","getTime","Math","random"],"sourceRoot":""}